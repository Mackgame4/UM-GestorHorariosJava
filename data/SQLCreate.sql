CREATE DATABASE IF NOT EXISTS gh;

USE gh;

CREATE TABLE IF NOT EXISTS diretores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS alunos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    numero VARCHAR(255) NOT NULL,
    estatuto BOOLEAN DEFAULT FALSE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

ALTER TABLE alunos ADD UNIQUE INDEX (numero);

CREATE TABLE IF NOT EXISTS unidades_curriculares (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    codigo VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

ALTER TABLE unidades_curriculares ADD UNIQUE INDEX (codigo);

CREATE TABLE aluno_UCs (
    aluno_num VARCHAR(255),
    uc_cod VARCHAR(255),
    FOREIGN KEY (aluno_num) REFERENCES alunos(numero),
    FOREIGN KEY (uc_cod) REFERENCES unidades_curriculares(codigo),
    PRIMARY KEY (aluno_num, uc_cod)
);


CREATE TABLE IF NOT EXISTS turnos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cod VARCHAR(255) NOT NULL,
    tipo INT NOT NULL,
    inicio VARCHAR(255) NOT NULL,
    fim VARCHAR(255) NOT NULL,
    diaSemana VARCHAR(255) NOT NULL,
    sala VARCHAR(255) NOT NULL,
    idUC VARCHAR(255) NOT NULL,
    capacidade INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

ALTER TABLE turnos ADD UNIQUE INDEX (cod);

CREATE TABLE horarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    numAluno VARCHAR(20) NOT NULL
);

CREATE TABLE horarios_turnos (
    horarioID INT NOT NULL,
    turnoCod VARCHAR(20) NOT NULL,
    FOREIGN KEY (horarioID) REFERENCES horarios(id),
    FOREIGN KEY (turnoCod) REFERENCES turnos(cod)
);
